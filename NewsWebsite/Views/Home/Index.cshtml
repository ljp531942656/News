@using System.Data;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/shared/_LayoutPage1.cshtml";
}
<link href="~/CSS/index.css" rel="stylesheet" />

<div class="container">

    <div class="title">新闻网站</div>

    <div class="main">
        <div id="sider" class="sider">
            <div class="totop glyphicon glyphicon-chevron-up"></div>
            <ul class="mainlist">
                <li class="active">主页</li>
                <li id="newstypelist">新闻分类</li>
                <li id="search">搜索</li>
                <li id="about">关于</li>
                <li class="zw"></li>
            </ul>
            <ul class="newstypelist">
                <li>返回</li>
                <li>社会动态</li>
                <li>金融财经</li>
                <li>激情体育</li>
                <li>科技前沿</li>
                <li>汽车资讯</li>
                <li>房产</li>
                <li>军事</li>
                <li>娱乐</li>
                <li>健康</li>
                <li>其它</li>
            </ul>
            <div class="tobottom glyphicon glyphicon-chevron-down"></div>
        </div>
        <div id="content" class="content">
            <div class="maintop col-lg-12 col-md-12 col-xs-12">
                <div class="lefttop col-lg-6 col-md-6 col-xs-6">
                    <div class="pic">
                        @{
                            string[] title = new string[5];
                            string[] tourl = new string[5];
                            int i = 0;
                            foreach (DataRow dr in (ViewData["PICList"] as DataTable).Rows)
                            {
                                title[i] = dr["title"].ToString();
                                tourl[i] = dr["tourl"].ToString();
                                i++;
                                <div class="p" style="background-image:url('@dr["PICORIGIN"]');"></div>
                            }
                        }
                        <div class="point">
                            <a id="ti" href=""></a>
                            <div id="po1" class="po" num="0"></div>
                            <div id="po2" class="po" num="1"></div>
                            <div id="po3" class="po" num="2"></div>
                            <div id="po4" class="po" num="3"></div>
                            <div id="po5" class="po" num="4"></div>
                        </div>
                    </div>
                </div>
                <div class="righttop col-lg-6 col-md-6 col-xs-6">
                    <div class="rtcontent">
                        <div class="shadowblock">
                            <a>最新热点<span class="glyphicon more"></span></a>
                        </div>
                        <ul class="list-group">
                            @foreach (DataRow dr in (ViewData["TOP7News"] as DataTable).Rows)
                            {
                                <li class="list-group-item">
                                    <a newsid="@dr["ID"]" istop="@dr["ISTOP"]">@dr["TITLE"]</a>
                                    <span>[@dr["DATE"]]</span>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
            <div class="mainbottom col-lg-12 col-md-12 col-xs-12">

                <div class="hotcomment">
                    <a>热门评论</a>
                    <ul id="comment" class="list-group">
                        <li class="list-group-item">
                            <a>好，大快人心呐</a>
                        </li>
                        <li class="list-group-item">
                            <a>现在这个社会什么人都有呐 唉</a>
                        </li>
                        <li class="list-group-item">
                            <a>毫无疑问，这个人嗑药了，害人害己啊。。</a>
                        </li>
                        <li class="list-group-item">
                            <a>我要上热评！！！！！顶我上去！！！！！</a>
                        </li>
                        <li class="list-group-item">
                            <a>十年前第一次和你说晚安，我激动的失眠了一整夜，十年后的今晚和你说晚安，不再失眠。但你的头压得我胳膊好酸。</a>
                        </li>
                        <li class="list-group-item">
                            <a>当你发现时间是贼时，它以偷光你的选择。</a>
                        </li>
                        <li class="list-group-item">
                            <a>那个背着行囊去大理寻找爱情的女子，最后还是选择了坐在宝马里哭</a>
                        </li>
                        <li class="list-group-item">
                            <a>不在一起就不在一起，反正一辈子也没多长。</a>
                        </li>
                    </ul>

                </div>
                <iframe style="margin:1% 0 0 4%" src="http://tianqi.5ikfc.com:90/plugin-code/?style=9&dy=5&city=foshan" allowTransparency="true" frameborder="0" scrolling="no" width="660" height="180" id="weather_frame"></iframe>
            </div>


            <div id="shdt" class="typedetail col-lg-12 col-md-12">
                <div class="PW col-lg-8 col-md-8 col-xs-8">
                    @foreach (DataRow dr in (ViewData["SHDT"] as DataTable).Rows)
                    {
                        <div class="imgupload PWinside" type="@dr["NEWSTYPE"]" num="@dr["TYPENUM"]">
                            @if (dr["TYPENUM"].ToString() == dr["TYPENUM"].ToString())
                            {
                                <img onclick="window.open('@dr["TOURL"]')" src="@(dr["PICORIGIN"])" />
                                <a href="@dr["TOURL"]" target="_blank">@dr["TITLE"]</a>
                                if (dr["RESUME"].ToString() != "")
                                {
                                    <p>@dr["RESUME"]</p>
                                    <div onclick="window.open('@dr["TOURL"]')" class="imgback"></div>
                                }
                            }
                        </div>
                    }
                </div>
                <div class="W col-lg-4 col-md-4 col-xs-4">
                    <div class="shadowblock">
                        <a>社会动态<span class="glyphicon more"></span></a>
                    </div>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a newsid="1156" istop="是" class="redfont">测试批量删除</a>
                            <span>[2018-03-26]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="1157" istop="是" class="redfont">测试批量删除</a>
                            <span>[2018-03-26]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="47" istop="是" class="redfont">修改测试标题</a>
                            <span>[2018-01-18]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="14" istop="是" class="redfont">3测试</a>
                            <span>[2018-01-18]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="1161" istop="否">1</a>
                            <span>[2018-03-29]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="147" istop="否">map</a>
                            <span>[2018-02-05]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="142" istop="否">1</a>
                            <span>[2018-01-30]</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div id="jrcj" class="typedetail col-lg-12 col-md-12">
                
            </div>
            <div id="jqty" class="typedetail col-lg-12 col-md-12">

            </div>
            <div id="kjqy" class="typedetail col-lg-12 col-md-12">

            </div>
            <div id="qczx" class="typedetail col-lg-12 col-md-12">

            </div>
            <div id="fc" class="typedetail col-lg-12 col-md-12">

            </div>
            <div id="js" class="typedetail col-lg-12 col-md-12">

            </div>
            <div id="yl" class="typedetail col-lg-12 col-md-12">

            </div>
            <div id="jk" class="typedetail col-lg-12 col-md-12">

            </div>
            <div id="qt" class="typedetail col-lg-12 col-md-12">
                <div class="PW col-lg-8 col-md-8 col-xs-8">
                    @foreach (DataRow dr in (ViewData["SHDT"] as DataTable).Rows)
                    {
                        <div class="imgupload PWinside" type="@dr["NEWSTYPE"]" num="@dr["TYPENUM"]">
                            @if (dr["TYPENUM"].ToString() == dr["TYPENUM"].ToString())
                            {
                                <img onclick="window.open('@dr["TOURL"]')" src="@(dr["PICORIGIN"])" />
                                <a href="@dr["TOURL"]" target="_blank">@dr["TITLE"]</a>
                                if (dr["RESUME"].ToString() != "")
                                {
                                    <p>@dr["RESUME"]</p>
                                    <div onclick="window.open('@dr["TOURL"]')" class="imgback"></div>
                                }
                            }
                        </div>
                    }
                </div>
                <div class="W col-lg-4 col-md-4 col-xs-4">
                    <div class="shadowblock">
                        <a>社会动态<span class="glyphicon more"></span></a>
                    </div>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a newsid="1156" istop="是" class="redfont">测试批量删除</a>
                            <span>[2018-04-18]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="1157" istop="是" class="redfont">测试批量删除</a>
                            <span>[2018-04-16]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="47" istop="是" class="redfont">修改测试标题</a>
                            <span>[2018-04-15]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="14" istop="是" class="redfont">3测试</a>
                            <span>[2018-04-15]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="1161" istop="否">1</a>
                            <span>[2018-04-14]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="147" istop="否">map</a>
                            <span>[2018-03-29]</span>
                        </li>
                        <li class="list-group-item">
                            <a newsid="142" istop="否">1</a>
                            <span>[2018-03-28]</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div id="aboutme" class="aboutme col-lg-12 col-md-12">

            </div>

            <div id="dosearch" class="search col-lg-12 col-md-12">

            </div>
        </div>
    </div>
</div>
<div class="back"></div>

@RenderPage("../shared/footer.cshtml")

<script>
    $(document).ready(function () {
        $("body").css("opacity", "1");
        $(".back").height(window.innerHeight);

        $("#sider>ul>li:not(.zw)").click(function () {
            $(this).addClass("active");
            $(this).siblings("li").removeClass("active");
        });

        $(".mainlist>li:first-child").click(function () {
            $("#aboutme").fadeOut(100).siblings("div:first-child").fadeIn(200);
            $("#aboutme").fadeOut(100).siblings("div:nth-child(2)").fadeIn(200);
            $(".maintop").fadeIn(200).siblings("div:not(:nth-child(2))").fadeOut(200);
            $(".mainbottom").fadeIn(200).siblings("div:not(:first-child)").fadeOut(200);
        });

        $("#newstypelist").click(function () {
            $(".newstypelist li").removeClass("active");
            $(".newstypelist").css("opacity", "1");
            $(".newstypelist").css("left", "0");
            $(".mainlist").css("transform", "scale(0.93)");
            $(".tobottom").css("opacity", "1");
        });
        $(".newstypelist>li:first-child").click(function () {
            $(".typedetail").fadeOut(100).siblings("div:first-child").fadeIn(200);
            $(".typedetail").fadeOut(100).siblings("div:nth-child(2)").fadeIn(200);
            $(".mainlist>li:first-child").trigger("click");
            $(".newstypelist").css("left", "150px");
            $(".mainlist").css("transform", "scale(1)");
            $(".newstypelist").css("opacity", "0.7");
            $(".totop").css("opacity", "0");
            $(".tobottom").css("opacity", "0");
        });
        $(".newstypelist>li:not(first-child)").click(function () {
            Switch($(this).text());
        });

        $("#about").click(function () {
            $("#aboutme").fadeIn(300).siblings("div").fadeOut(150);
        });

        $("#search").click(function () {
            $("#dosearch").fadeIn(300).siblings("div").fadeOut(150);
        });

        $(".hotcomment .list-group-item").height($(".hotcomment .list-group").height() / 5);
        $(".hotcomment .list-group-item").css("line-height", $(".hotcomment .list-group").height() / 5 - 3.2 + "px");
        $(".hotcomment .list-group-item a").width($(".hotcomment .list-group-item").width() - 20);
        $(".rtcontent .list-group-item").height($(".rtcontent .list-group").height() / 7);
        $(".rtcontent .list-group-item").css("line-height", $(".rtcontent .list-group").height() / 7 - 2 + "px");
        $(".rtcontent .list-group-item a").width($(".rtcontent .list-group-item").width() - $(".rtcontent .list-group-item span").width() - 20);
        $(".rtcontent .list-group-item a[istop='是']").addClass("redfont");
        $(".rtcontent .list-group-item a").click(function () {
            window.open("@Href("~/")Home/NewsPage?newsid=" + $(this).attr("newsid"));
        });

        $(".totop").width($("#sider>ul>li").width());
        $(".tobottom").width($("#sider>ul>li").width());
        $(".totop").css("top", $(".main").css("margin-top"));
        $(".tobottom").css("top", $(window).height() - parseFloat($(".main").css("margin-top")) - $(".tobottom").height());
        $("#sider>ul").scroll(function () {
            var viewH = $(this).height();
            var contentH = $(this).get(0).scrollHeight;
            var scrollTop = $(this).scrollTop();
            if (scrollTop / (contentH - viewH) >= 0.95) {
                $(".tobottom").css("opacity", "0");
            }
            else {
                $(".tobottom").css("opacity", "1");
            }
            if ($(this).scrollTop() != 0) {
                $(".totop").css("opacity", "1");
            }
            else {
                $(".totop").css("opacity", "0");
            }

        });
        $(".totop").click(function () {
            $("#sider>.newstypelist").animate({ scrollTop: $("#sider>.newstypelist").scrollTop() - 300 });
        });
        $(".tobottom").click(function () {
            $("#sider>.newstypelist").animate({ scrollTop: $("#sider>.newstypelist").scrollTop() + 300 });
        });

        //热门评论滚动
        $(".hotcomment .list-group").append($(".hotcomment .list-group").html());
        var scroll = setInterval(function () { ScrollComment() }, parseInt(12000 / document.getElementById("comment").clientHeight));
        $(".hotcomment .list-group-item").mouseover(function () {
            clearInterval(scroll);
        })
        $(".hotcomment .list-group").mouseleave(function () {
            scroll = setInterval(function () { ScrollComment() }, parseInt(12000 / document.getElementById("comment").clientHeight));
        });
        $(window).resize(function () {
            clearInterval(scroll);
            scroll = setInterval(function () { ScrollComment() }, parseInt(12000 / document.getElementById("comment").clientHeight));
        })


        var t = 0;
        var m;
        function show() {
            $(".p").fadeOut();
            $(".po").css("background-color", "#676c6d");

            switch (t) {
                case 0:
                    $($(".pic").children(".p")[0]).fadeIn().attr("onclick", "window.open('@tourl[0]')");
                    $("#po1").css("background-color", "#a7b0af");
                    $("#ti").html("@title[0]").attr("href", "@tourl[0]").attr("target", "_blank");
                    break;
                case 1:
                    $($(".pic").children(".p")[1]).fadeIn().attr("onclick", "window.open('@tourl[1]')");
                    $("#po2").css("background-color", "#a7b0af");
                    $("#ti").html("@title[1]").attr("href", "@tourl[1]");
                    break;
                case 2:
                    $($(".pic").children(".p")[2]).fadeIn().attr("onclick", "window.open('@tourl[2]')");
                    $("#po3").css("background-color", "#a7b0af");
                    $("#ti").html("@title[2]").attr("href", "@tourl[2]");
                    break;
                case 3:
                    $($(".pic").children(".p")[3]).fadeIn().attr("onclick", "window.open('@tourl[3]')");
                    $("#po4").css("background-color", "#a7b0af");
                    $("#ti").html("@title[3]").attr("href", "@tourl[3]");
                    break;
                case 4:
                    $($(".pic").children(".p")[4]).fadeIn().attr("onclick", "window.open('@tourl[4]')");
                    $("#po5").css("background-color", "#a7b0af");
                    $("#ti").html("@title[4]").attr("href", "@tourl[4]");
                    break;
            }
            if (t >= 4) { t = 0; }
            else { t++; }
            m = setTimeout(show, 2000);
        }
        function resetTimout(n) {
            clearTimeout(n);
            show();
        }
        show();
        $("#po1").css("background-color", "#a7b0af");
        $(".point>.po").click(function () {
            $(this).css("background-color", "#a7b0af");
            $(this).siblings("div.po").css("background-color", "#676c6d");
            t = parseInt($(this).attr("num"));
            resetTimout(m);
        });
        $(".point").css("top", $(".pic").height() - $(".point").height() + 1);
    });
    $(window).resize(function () {
        setTimeout(function () {
            $(".totop").width($("#sider>ul>li").width());
            $(".tobottom").width($("#sider>ul>li").width());
            $(".totop").css("top", $(".main").css("margin-top"));
            $(".point").css("top", $(".pic").height() - $(".point").height() + 1);
            $(".tobottom").css("top", $(window).height() - parseFloat($(".main").css("margin-top")) - $(".tobottom").height());
            $(".hotcomment .list-group-item").height($(".hotcomment .list-group").height() / 5);
            $(".hotcomment .list-group-item").css("line-height", $(".hotcomment .list-group").height() / 5 - 3.2 + "px");
            $(".hotcomment .list-group-item a").width($(".hotcomment .list-group-item").width() - 10);
            $(".rtcontent .list-group-item").height($(".rtcontent .list-group").height() / 7);
            $(".rtcontent .list-group-item").css("line-height", $(".rtcontent .list-group").height() / 7 - 2 + "px");
            $(".rtcontent .list-group-item a").width($(".rtcontent .list-group-item").width() - $(".rtcontent .list-group-item span").width() - 20);
        }, 300);

        $(".footer").height((window.innerHeight - $(".footer").height()) * 0.15);
    });

    //新闻分类选择
    function Switch(type) {
        switch (type) {
            case "社会动态": {
                $("#shdt").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "金融财经": {
                $("#jrcj").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "激情体育": {
                $("#jqty").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "科技前沿": {
                $("#kjqy").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "汽车资讯": {
                $("#qczx").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "房产": {
                $("#fc").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "军事": {
                $("#js").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "娱乐": {
                $("#yl").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "健康": {
                $("#jk").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
            case "其它": {
                $("#qt").fadeIn(300).siblings("div").fadeOut(150);
                break;
            }
        }
    }

    $(".PWinside").mouseenter(function () {
        $(this).children(".imgback").height($(this).height());
        $(this).children(".imgback").css("top", -28 - 1 * $(this).children("p").height() - $(this).height()).css("opacity", "1");
        $(this).children("a").css("top", -28 - $(this).children("p").height());
        $(this).children("p").css("top", -28 - $(this).children("p").height()).css("opacity", "1");
    });
    $(".PWinside").mouseleave(function () {
        $(this).children(".imgback").height(0);
        $(this).children(".imgback").css("top", -28 - 1 * $(this).children("p").height()).css("opacity", "0");
        $(this).children("a").css("top", -28);
        $(this).children("p").css("top", -28).css("opacity", "0");
    });


    //热门评论滚动
    function ScrollComment() {
        var hotcomment = document.getElementById("comment");
        if (hotcomment.scrollTop >= hotcomment.clientHeight * 1.54) {
            hotcomment.scrollTop = 0;
        }
        else {
            hotcomment.scrollTop++;
        }
    }

    //function findphoto(html) {
    //    var photo = "";
    //    var flag = 0;
    //    html.replace(/<img src=['"]([^'"]+)[^>]*>/gi, function (img) {
    //        var obj = new Object();
    //        img.replace(/<img src=['"]([^'"]+)[^>]*>/, function (match, url) {
    //            obj.url = url;
    //        });
    //        img.replace(/width=['"]([^'"]+)/, function (match, width) {
    //            obj.width = width;
    //        });
    //        img.replace(/height=['"]([^'"]+)/, function (match, height) {
    //            obj.height = height;
    //        });
    //        if ((obj.width >= 400 || obj.height >= 400) && flag == 0) {
    //            photo = obj.url;
    //            flag++;
    //        }
    //    });
    //}
</script>